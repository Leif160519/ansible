##
# 安装基础软件
#
#
##
# @leif160519 @2020.08.29
####
---
- name: 安装基础软件
  hosts: all
  tags: [install]
  tasks:
    - name: 安装常用软件 # {{{ | RedHat
      package:
        name: "{{ item }}"
        state: latest
      with_items:
        - yum-utils
        - epel-release
        - nagios
        - nc
        - perf
        - bind-utils
      when: ansible_os_family == "RedHat"
      # }}}

    - name: 安装常用软件 # {{{ | Debian
      package:
        name: "{{ item }}"
      with_items:
        - rar
        - python-pip
        - screenfetch
        - neofetch
        - linuxlogo
      when: ansible_os_family == "Debian"
      # }}}

    - name: 安装“神器”软件 # {{{ | Debian | 来源·知乎：https://www.zhihu.com/question/59227720
      package:
        name: "{{ item }}"
      with_items:
        - silversearcher-ag # ag:比grep、ack更快的递归搜索文件内容
        - tig # 字符模式下交互查看git项目，可以替代git命令
        - mycli # mysql客户端，支持语法高亮和命令补全，效果类似ipython，可以替代mysql命令
        - jq # 文件处理以及格式化显示，支持高亮，可以替换python -m json.tool
        - shellcheck # shell脚本静态检查工具，能够识别语法错误以及不规范的写法
        - mosh # 基于UDP的终端连接，可以替代ssh，连接更稳定，即使IP变了，也能自动重连
        - fzf # 命令行下模糊搜索工具，能够交互式智能搜索并选取文件或者内容，配合终端ctrl-r历史命令搜索简直完美
        - axel # 多线程下载工具，下载文件时可以替代curl、wget
        - lrzsz # sz/rz:交互式文件传输，在多重跳板机下传输文件非常好用，不用一级一级传输
        - cloc # 代码统计工具，能够统计代码的空行数、注释行、编程语言
        - ccache # 高速C/C++编译缓存工具，反复编译内核非常有用
        - tmux # 终端复用工具，替代screen、nohup
        - neovim # 替代vim
        - mc # mcedit：终端下面的 NotePad++
        - icdiff # 分屏显示 diff
        - powerman # pm：在 bash / zsh 中迅速切换项目目录
        - ncdu # 可视化的空间分析程序
        - glances # 更强大的 htop / top 代替者
        - ranger # 内容浏览/预览
        - dstat # vmstat 代替者
        - pcp
        - multitail # 多重 tail
        - tldr # 如果你经常不想详读man文档，那么你应该试试这个小工具
        - figlet # 将输入字符转换成艺术字体
      when: ansible_os_family == "Debian"
      # }}}

    - package: # {{{ | Linux通用软件包
        name: "{{ item }}"
        state: latest
      with_items:
        - nano
        - vim
        - emacs
        - zip
        - unzip
        - git
        - bash-completion
        - wget
        - htop
        - iotop
        - nethogs
        - mrtg
        - telnet
        - tree
        - tmux
        - iperf
        - figlet
        - lsof
        - dpkg
        - expect
        - hdparm
        - psmisc
        - fping
        - tcpdump
        - nmap
        - fio
        - strace
        - sysstat
        - lrzsz
        - monit
        - ansible
        - dosfstools
        - iftop
        - uuid
        - make
        - colordiff
        - subnetcalc
        - groovy
        - python
        - python3
        - python3-pip
        - w3m
        - lynx
        - dos2unix
        - nethogs
        - curl
        - nload # 流量监控 nload -u M <network_interface>
        - cifs-utils # windows 文件系统支持
        - xfsprogs # xfs文件系统支持
        - exfat-utils # exfat 文件系统支持
        - net-tools # 网络工具
        - rename # 批量重命名
        - curlftpfs # ftp 挂载工具
      ignore_errors: yes
      # }}}

    - name: 启动相关服务 # {{{
      service:
        name: "{{ item }}"
        state: started
        enabled: yes
      with_items:
        - sysstat
        - monit
      ignore_errors: yes
      # }}}

    - name: 清理无用的安装包缓存 # {{{ | Debian
      apt:
        autoclean: yes
      when: ansible_os_family == "Debian"
      # }}}

    - name:  清理不再使用的依赖包 # {{{ | Debian
      apt:
        autoremove: yes
      when: ansible_os_family == "Debian"
      # }}}

    - name: 清理下载的安装包缓存 #  {{{ | Debian
      shell: apt clean && apt autoclean
      ignore_errors: yes
      when: ansible_os_family == "Debian"
      # }}}

    - name: 卸载snapd # {{{ | Debian
      shell: apt -y autoremove --purge snapd
      ignore_errors: yes
      when: ansible_os_family == "Debian"
      # }}}

    - name: 清理安装包 # {{{ | Redhat
      shell: yum clean all
      ignore_errors: true
      when: ansible_os_family == "RedHat"
      # }}}

# {{{ 安装其他软件
- import_playbook: "rar.yml"

- import_playbook: "ccat.yml"
# }}}
